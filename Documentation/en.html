<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Quenlig: Online Questionnary</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link href="doc.css" rel="stylesheet">
    <link REL="icon" HREF="../HTML/favicon.ico">
  </head>
  <script src="doc.js"></script>

  <body onload="make_style()" onclick="setTimeout('make_style()',100)">
    <div class="menu">
      <p>
      Table of Content</p>
    <ul>
      <li> <a href="#quoi">What's Quenlig?</a></li>
      <li> <a href="#run">Running Quenlig</a></li>
      <li> <a href="#create">Questionnary Creation</a></li>
      <li> <a href="#question_creation">Question Creation</a></li>
      <li> <a href="#question_reference">Question Reference</a>
      <ul>
      <li> <a href="#name"><tt>name</tt></a></li>
      <li> <a href="#required"><tt>required</tt></a></li>
      <li> <a href="#before"><tt>before</tt></a></li>
      <li> <a href="#question"><tt>question</tt></a></li>
      <li> <a href="#tests"><tt>tests</tt></a></li>
      <li> <a href="#indices"><tt>indices</tt></a></li>
      <li> <a href="#nr_lines"><tt>nr_lines</tt></a></li>
      <li> <a href="#default_answer"><tt>default_answer</tt></a></li>
      <li> <a href="#highlight"><tt>highlight</tt></a></li>
      <li> <a href="#maximum_bad_answer"><tt>maximum_bad_answer</tt></a></li>
      <li> <a href="#maximum_time"><tt>maximum_time</tt></a></li>
      <li> <a href="#good_answer"><tt>good_answer</tt></a></li>
      <li> <a href="#bad_answer"><tt>bad_answer</tt></a></li>
      <li> <a href="#courses"><tt>courses</tt></a></li>
      <li> <a href="#perfect_time"><tt>perfect_time</tt></a></li>
      </ul>
      </li>
      <li> <a href="#session_management">Session Management</a></li>
      <li> <a href="#student_management">Student Management</a></li>
      <li> <a href="#access_rights">Access rights</a></li>
      <li> <a href="#author_work">Author work</a></li>
      <li> <a href="#test_creation">Test creation</a>
      <ul>
      <li> <a href="#leaves">Leaves</a></li>
      <li> <a href="#canonizers">Canonizers</a></li>
      </ul>
      </li>
      <li> <a href="#plugin_creation">Plugin creation</a>
      <ul>
      <li><a href="#trigger">What is triggering ?</a></li>
      <li><a href="#evaluation">Evaluation</a></li>
      <li><a href="#display">What is displayed ?</a></li>
      </ul>
      </li>

      <li> <a href="#developper_tools">Developper tools</a></li>
    </ul>
    </div>

    <div class="texte">
    <h1>Quenlig: Online Questionnary</h1>

    <p>
      This documentation can be read from begin to end,
      it starts with the most common pattern usages
      and also contains links to full technical references.
      As the system is easely extensible in many ways
      it is adaptable to any usage case.
    </p>

    <h2><a name="quoi">What's Quenlig?</a></h2>

    <p>
      Quenlig allow to create interactive "free text" questionnaries
      on the web.
    </p>
    <ul>
      <li> It displays a question list containing only answerable questions.
	A question is answerable only if all the prerequired questions
	have yet been answered.
      </li>
      <li> The student choose a question in the list, then Quenlig
	displays:
	<ul>
	  <li> Some informations needed before answering the question,
	    as fragments of the courses, things to be prepared before
	    answering.
	  <li> The question text.
	  <li> The place where the student enter its answer.
	  <li> A link allowing to get a tip to answer the question.
	</ul>
      </li>
      <li> When the student answer, Quenlig may display additionnal information
	to explain its bad answer, to guide the student to the good answer
	or to a better answer,
	or to give additionnal information contextual to the student answer.

      <li> Quenlig displays statistics about the work done by the student:
	the number of questions done or to do, the number of bad answers,
	the number of tips asked and the rank of the student in the class.
      </li>
      
      <li> Quenlig allows the student to see all its answers,
	to leave a comment for the teacher about the question,
	to see an help page about the questionnary.
      </li>

      <li> Quenlig allows the teachers to locate students with problems
	or cheaters.
	It provides questionnary author with analysis tools in order to
	enhances the questionnary.
	</li>
    </ul>

    
    <h2><a name="run">Running Quenlig</a></h2>

    <p>You can try a french unix questionnary at this place (you need
      to enter an alias):
      <a href="http://demo710.univ-lyon1.fr/-quenlig-/guest.html">
        http://demo710.univ-lyon1.fr/-quenlig-/guest.html
	</a>
    </p>
    <p>To run your own server, use the following suite of commands:
    </p>
    <pre>
# Create in 'Students' directory a new questionnary session.
# The questions are in the directory 'Questions/unix'
# When running the server will be listening on TCP port 9999
./main.py Unix2010Spring create Questions/unix 9999
# The guest user named 'admin' will be session administrator.
./main.py Unix2010Spring admin guestadmin
# Start the server, it displays the URL to use to access it.
./main.py Unix2010Spring start
</pre>
    <p>If you use CAS authentication, you can
      configure Quenlig to use it.
      </p>

    <h2><a name="create">Questionnary creation</a></h2>
    <p>
      The questionnaries are not defined as data structures
      but as Python programs.
      This is much more flexible approach,
      it allows to have algorithms creating the question and checking
      the answers.
    </p>
    <p>
      The questionnaries are defined in 'Questions' directory.
      The 'C_variable' directory contains a small commented questionnary.
      The questionnary directory must contain an empty <tt>__init__.py</tt>
      file to please Python.
    </p>
    <p>
      The filenames used to contains the questions are visible by the students.
      The filename must be short, it defines in one word the subject
      or domain of all the questions it contains.
      This name is important, it helps the student to see the context
      of the question.
    </p>
    <p>
      Each file contains questions, the recommended way to create
      questions is to start from the most simple ones.
      When a complex question is defined, it requires that the student
      answered correctly a set of other questions.
      This set of other question ensure that the student
      has the needed knowledges to answer the complex one.
    </p>
    <p>
      When Quenlig displays a question, it displays the information
      about the required questions.
      This will give the student a context to answer the current question.
      It will see its old answers and may reuses parts of them to answer.
    </p>

    <h2><a name="question_creation">Question creation</a></h2>
    <p>
      The file containing the questions should start by
    </p>
    <pre>
# -*- coding: utf-8 -*- 
from questions import * # all the needed functions
</pre>

    A minimal question is:
    <pre>
add(name="hello",
    question="Are you ready?",  # Question text is in HTML
    tests=(
           Good(Equal("yes")),
          )
    )
</pre>
    <p>
      If you want to add a comment about the student answer:
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(<em>Comment(</em>Equal("yes")<em>,
	                "Hit return to see the next question")</em>
               ),
          )
    )
</pre>
    <p>
      This question requires that the student answer exactly 'yes'
      and not 'Yes' or 'YES'.
      To turn arround this problem, the student answer can be uppercased.
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(<em>UpperCase(</em>Equal("yes")<em>)</em>),
          )
    )
</pre>
    <p>
      If you also want to allow the answer 'sure' and the digit '1'
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(Equal("yes")<em>
	                  | Equal("sure")
			  | Equal("1")</em>)),
          )
    )
</pre>
    <p>
      If you don't like complex expression, it is possible to write:
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(Equal("yes"))),
<em>           Good(UpperCase(Equal("sure"))),
           Good(Equal("1")),</em>
          )
    )
</pre>
    <p>
      The tests are done from the first to the last until a test
      tell that the answer is good or bad.
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(Equal("yes"))),
<em>           Bad(UpperCase(Comment(Equal("no"),
                                 "Are you joking?")),</em>
           Good(UpperCase(Equal("sure"))),
          )
    )
</pre>
    <p>
      If a student answer 'Yes I am' its answer will be rejected,
      we should not test equality, but only that its answer contains 'yes'.
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(<em>Contain</em>("yes"))),
          )
    )
</pre>
    <p>
      There is no help if the students answers 'foobar',
      it is not nice for the student.
      The tilda indicates the negation, so the student answer
      does not contain 'yes'.      
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(Contain("yes"))),
           <em>Bad(UpperCase(Comment(~ Contain("yes"),
                                 "Please answer 'yes' or 'no'")
	                )),</em>
          )
    )
</pre>
    <p>
      Another way to add help is to allow the student to ask tips.
      Most of the time it is better to give a good bad answer
      comment than to add tips.
      The students do not know when to ask tips, some always ask them,
      some never. And they are frustrated when the tip was yet
      given in a bad answer comment or when it is as lame as « Read the manual »
    </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(UpperCase(Contain("yes"))),
          )<em>,
    indices = ("You must answer a 3 letters english word",
               # The tip are in HTML
	       "Enter &lt;b&gt;yes&lt;/b&gt; if you are ready.",
	      ),</em>
   )
</pre>
    <p>
      Or a more simple way to do all this is to use a base test
      that does all this work:
   </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           <em>Good(Yes()),</em>
	   ),
    )
</pre>
    <p>
      It is possible to check the number of bad answers in order
      to give a tip to the stucked student.
   </p>
    <pre>
add(name="hello",
    question="Are you ready?",
    tests=(
           Good(Yes()),
           <em>Bad(Comment(NrBadAnswerGreaterThan(3),
                       "Stop playing, and start working. Answer: YES")),</em>
	   ),
    )
</pre>   
    <p>
      Now if the student answered this first question, a second
      question must be available.
      With the following test, any number greater or equal to 18 are
      a good answer.
      If the student enter a string that is not a number, a comment
      will explain that an integer answer is required.
   </p>
     <pre>
add(name="age",
    question="How old are you?",
    <em>required=["hello"],</em>
    tests=(
          Good(IntGT("17")),
	   ),
    )
</pre>   
    <p>
   Do not forget, the order of the tests is important, the bad test
   will never make it if you put it after the good one:
   </p>
     <pre>
add(name="age",
    question="How old are you?",
    required=["hello"],
    tests=(
          <em>Bad(Comment(IntGT("100"), "Your real age please.")),</em>
          Good(IntGT("17")),
	   ),
    )
</pre>   
    <p>
      An another problem is that students may append 'years' to their answer.
      It is possible to get ride of it by using a replacement.
      The 'Replace' operator apply all the string substitutions to
      the student answer before continuing the testing.
   </p>
     <pre>
add(name="age",
    question="How old are you?",
    required=["hello"],
    tests=(
          Good(<em>Replace((
                        (' ', ''),
                        ('years', ''),
                       ), </em>IntGT("17")<em>)</em>),
	   ),
    )
</pre>
     <p>
       If you also want to accept '20 Years' with an uppercase then
       there is a little problem because canonizers are not applied
       to <tt>Replace</tt> parameters.
       It is done so because for most of the canonizers there is little sense
       to apply to string parts.
       The correct way to do the test is presently:
     </p>
     <pre>
add(name="age",
    question="How old are you?",
    required=["hello"],
    tests=(
          Good(<em>UpperCase(</em>Replace((
                        (' ', ''),
                        ('<em>YEARS</em>', ''),
                       ), IntGT("17"))<em>)</em>),
	   ),
    )
</pre>
     <p>
       It is possible to display and check random questions:
     </p>
     <pre>
choices = {'VARIABLE' : ("a", "b", "c"),
           'VALUE'    : ("100", "2", "333", "42"),
          }
add(name="affectation",
    question=random_question("How to store VALUE in the variable VARIABLE?",
                             choices),
    tests=(Good(Random(choices,
                       Replace(((' ',''),),
                               Equal("VARIABLE=VALUE;")))
                      )
               ),
           Random(choices, Expect("VARIABLE")),
           Random(choices, Expect("VALUE")),
           Expect("="),
           Expect(";"),
          ),
    )
</pre>
      
    <h2><a name="question_reference">Question reference</a></h2>

    <p>
      There are all the possible arguments of the 'add' question function.
    </p>
      

    
    <h3><a name="name">Parameter: <tt>name</tt></a></h3>

    <p>
      It is the question name, keep it short and avoid special characters,
      especially '/', ':', '(', ')'. It may contain spaces.
      It is the name displayed in the question list,
      so it must not clearly give the good answer.
    </p>

    <h3><a name="required">Parameter: <tt>required</tt></a></h3>

    <p>
      It is a list of required question name that must have been answered
      in order to see this one.
      If this parameter is not provided then the preceding question
      in the file is considered as required.
      <b>It is a bad idea to do so because a change in the questions order
	will break the dependencies tree.</b>
      If there is not preceding question, then there is no dependencies
      and the question will be visible immediatly.
    </p>
    <p>
      If a question name contains <tt>:</tt>
      then it references a question in another file of the questionnary.
      The left part is the filename without the <tt>.py</tt> extension.
    </p>
    <p>
      If the question name is followed by <tt>(regular expression)</tt>
      then the student answer must match the regular expression.
      For example <tt>personnel:sexe([mM])</tt>
      will require that the answer given to 'sexe' question in
      the 'personnel.py' file is 'm' or 'M'.
    </p>
    <p>
      If the name contains:
      <ul>
	<li> <tt>{unrequired}</tt>: the student does not need to
	  give a good answer. The student needs only to read it.
	<li> <tt>{before}</tt>: in the question required list,
	  display the question <tt>before</tt> attribute.
	<li> <tt>{hide}</tt>: in the question required list,
	  hide the question and the student answer.
      </ul>
    </p>

    <h3><a name="before">Parameter: <tt>before</tt></a></h3>

    <p>
      Defines the text displayed before the question itself.
      It contains general explanation to help the student
      or things that must be done or checked BEFORE reading the
      question itself.
    </p>
    <p>
      The value of this parameter can be an HTML string or a function
      returning an HTML string.
      The function may have a 'state' parameter allowing to get
      information about the student or the IP address of its computer.
    </p>
    <p>
      If in the function, random function are used, it will always
      return the same random serie. Each student will have a
      different random serie.
    </p>
    <p>
      To put 'my_picture' in the HTML, store the file in
      'Questions/YourQuestionnary/HTML/my_picture.png'
      and give the link: <tt>&lt;IMG SRC='my_picture.png'&gt;</tt>
    </p>
    <p>
      If you want to add a CSS style to your questionnary,
      put it in 'Questions/YourQuestionnary/HTML/questions.css'<br>
      You can also redefine existing translations, for example :
    </p>
    <pre>DIV.question_good > A:first-child.content > .box_title:before {
content: "Good! Press «Enter» to choose a random question." ;
}</pre>
    <p>
      If you want to add JS to your questionnary,
      put it in 'Questions/YourQuestionnary/HTML/questions.js'
    </p>
    
    <h3><a name="question">Parameter: <tt>question</tt></a></h3>

    <p>
      It is the question text, it is defined exactly as the 'before'
      parameter and so it may be generated specificaly for each student.
    </p>
    <p>
      It is possible to display check buttons in place
      of a free text input.
      To do so, in your question text, use <tt>{{{an answer}}}</tt>
      to indicate the possible choices.
      For example:
    </p>
      <pre>question = "Are you {{{M}}} male or {{{F}}} female?"</pre>
    <p>
      The possible student answer may be ' M' or ' F' or ' M F'.
    </p>
    <p>
      If you want radio button and not a checkbox, use '!':
    </p>
      <pre>question = "Are you {{{!M}}} male or {{{!F}}} female?"</pre>
    <p>
      If you want to randomize the order of the choices,
      then put <tt>{{{ shuffle}}}</tt> as a choice.
      Il will not be displayed.
      Beware: ' M F' and ' F M' are possible when shuffling.
    </p>
    <p>
      If you want to put a choice on the same line than the previous one,
      use '↑': <tt>{{{Y}}} Yes or {{{↑N}}} No</tt>.
    </p>
    <p>
      If you want to put a text without a button, use '{{{}}}':
      <pre>{{{}}} If you are sure: {{{↑Y}}} Yes, or {{{↑N}}} No
{{}}} If you hesitate: {{{↑None}}} not Y nor N, or {{{↑B}}} bad question</pre>
    </p>

    <h3><a name="tests">Parameter: <tt>tests</tt></a></h3>

    <p>
      The list of tests to be done on the student answer.
      If this parameter is not defined then the student will see
      the question but will not have a way to enter its answer.
    </p>
    <p>
      There is many tests in the
      <a href="tests.html">test reference documentation</a>.
      These tests are not all of the same kind:
    </p>
    <ul>
      <li> The final answer returns True to indicates a good
	answer, False for a bad and None if the testing must continue.
	For example:
	    <a href="tests.html#Good">Good</a>,
	    <a href="tests.html#Bad">Bad</a>,
	    <a href="tests.html#Yes">Yes</a>,
	    <a href="tests.html#No">No</a>,
	    <a href="tests.html#Expect">Expect</a>,
	    <a href="tests.html#Reject">Reject</a>,
      <li> The expression leaves really test the student answer,
	they return True is the test is fine.
	For example:
	    <a href="tests.html#Equal">Equal</a>,
	    <a href="tests.html#Start">Start</a>,
	    <a href="tests.html#End">End</a>,
	    <a href="tests.html#Contain">Contain</a>,
	    <a href="tests.html#IsInt">IsInt</a>,
	    <a href="tests.html#Int">Int</a>,
	    <a href="tests.html#IntLG">IntLG</a>,
	    <a href="tests.html#IntGT">IntGT</a>,
	    <a href="tests.html#NrBadAnswerGreaterThan">NrBadAnswerGreaterThan</a>,
	    <a href="tests.html#NumberOfIs">NumberOfIs</a>,
	    <a href="tests.html#TestFunction">TestFunction</a>,
	    <a href="tests.html#Length">Length</a>,
	    <a href="tests.html#LengthLT">LengthLT</a>,
	    <a href="tests.html#TestDictionnary">TestDictionnary</a>,

     <li> The string canonizers allows to transform the student answer
       and the teacher expected answer to make them as close as possible.
       Beware, the transformation is applied to the 'Equal' parameter
       but not to the 'Replace' string list because it has little sense.
       Example of canonizers:
	    <a href="tests.html#RemoveSpace">RemoveSpaces</a>,
	    <a href="tests.html#Replace">Replace</a>,
	    <a href="tests.html#SortLines">SortLines</a>,
	    <a href="tests.html#UpperCase">UpperCase</a>,
	    <a href="tests.html#Random">Random</a>.
	    Specific canonizers are defined in the questionnaries
	    for specific languages: Shell, Python, C, Cisco...

     <li> Boolean operation:
       <a href="tests.html#And">And</a> '&amp;',
       <a href="tests.html#Or">Or</a> '|',
       <a href="tests.html#TestInvert">Negation</a> '~',

	 <li> The comment operator that add a comment if its parameter
	   is True: <a href="tests.html#Comment">Comment</a>

    </ul>



    <h3><a name="indices">Parameter: <tt>indices</tt></a></h3>

    <p>
      A list of tips given as HTML strings.
      They are given one by one when asked.
    </p>


    
    <h3><a name="nr_lines">Parameter: <tt>nr_lines</tt></a></h3>

    <p>
      An integer defining the number of lines expected for the student
      answer. The default value is one.
    </p>

    <h3><a name="default_answer">Parameter: <tt>default_answer</tt></a></h3>

    <p>
      A string that defines a default answer.
      The student will modify this default answer in order to
      answer the question.
    </p>
    <p>
      It can also be a function with a <tt>state</tt> parameter
      and returning a string.
    </p>

    <h3><a name="highlight">Parameter: <tt>highlight</tt></a></h3>

    <p>
      If this parameter is True then the question is highlighted
      in the questions list.
      The student should answer to this question quickly because
      it is very contextual with its last answer.
    </p>


    <h3><a name="maximum_bad_answer">Parameter: <tt>maximum_bad_answer</tt></a></h3>

      <p>
	Specifies the maximum number of bad answer allowed.
	When the student has given the maximum bad answers
	the question will no more be in the question list.
	The student will not be able to answer the question.
      </p>

    <h3><a name="maximum_time">Parameter: <tt>maximum_time</tt></a></h3>

      <p>
	Specifies the maximum time in seconds to answer.
	Once the question on screen the count down start.
	It does not stop if the student look at other question
	or close the window.
      </p>

      <h3><a name="good_answer">Parameter: <tt>good_answer</tt></a></h3>

    <p>
      This HTML text will be displayed to the student
      when it answers correctly.
    </p>

    <h3><a name="bad_answer">Parameter: <tt>bad_answer</tt></a></h3>

    <p>
      This HTML string will be displayed to the student each time
      a bad answer is given.
      It will be displayed even if a specific bad answer comment
      is also given.
      So it is not a good way to do the feedback.
      <b>It is not recommended to use this parameter</b>.
    </p>
    <p>
      To add a comment on non commented bad answer a better way is
      to add this last test to the 'tests' parameter :
      <tt>Bad(Comment(Contain(''), "The comment"))</tt>
    </p>
    <p>
      The usage of Quenlig shows that generic bad answer comment
      does not really help the student.
    </p>

    <h3><a name="courses">Parameter: <tt>courses</tt></a></h3>

    <p>
      By default, all the questions with a <tt>before</tt> attribute
      and with <tt>courses</tt> defined
      are displayed by the 'course documentation' plugin.
    </p>
    <p>
      To structure the courses, the <tt>courses</tt> parameter defines
      the 'before text' position in the table of content:
      <tt>("2: Bases", "2.1: Types", "2.1.2: Floats")</tt>
      The table of content is sorted by titles.
      If multiple questions are in the same part, they are sorted
      using the <tt>required</tt> attribute.
      The numbering is optional, but it allows you to sort the items.

    <h3><a name="perfect_time">Parameter: <tt>perfect_time</tt></a></h3>

    <p>
      If the question is answered in less than the specified number
      of seconds, then the question is «perfectly answered».
      It is only useful with the <tt>competences</tt> plugin because
      it allows to retry to answer and display the number
      of perfect answers.
    </p>
    <p>
      The default value is 10 seconds
    </p>
    <p>
      If this time is too short, QUENLIG will automaticaly <b>increase</b> it
      to the median value of the time to make a good answer by
      the current session students.
      The time of the first good answer is not taken into account
      because it is far more longer than the next ones.
    </p>

    <h2><a name="session_management">Session Management</a></h2>

    <p>
      Quenlig management is done with the <tt>./main.py</tt> command.
      If you run it without parameter,
      it will display the help about the command line parameters
      and the list of sessions with the questionnary name,
      the TCP port used, the process and computer running it,
      the session start date and duration.
    </p>
    <p>
      The first parameter of <tt>./main.py</tt> is the session name.
      It is the name of the sub directory of 'Students' that
      contains all the informations about the session and the students.
      The following parameters defines actions and may be concatened.
      The most useful actions are:
    </p>
    <ul>
      <li> <tt>create Questions/C_variable 9999</tt> :
	    it creates a new session (the name is the first parameter),
	    using questions in 'Questions/C_variable' directory and
	    will be listening on TCP port 9999.
      <li> <tt>admin guestjoe</tt> : the role 'Teacher' is
	given to the guest user named 'joe'.
      <li> <tt>start</tt> : start the server for the session.
      <li> <tt>stop</tt> : stop the server for the session.
      <li> <tt>begin-date "15:00 31/1/2011"</tt> :
	The students will be allowed to start to work
	at 3PM the january 31 2011.
      <li> <tt>end-date "16:00 31/1/2011"</tt> :
	No more student answer will be accepted after 
	4PM the january 31 2011.
      <li> <tt>url "http://quenlig.my-university.org/session_name"</tt> :
	Quenlig server will assume that it is used with this URL.
	It is useful to hide the port number to students or to
	use a reverse proxy to jump over a firewall.
    </ul>
      
    <p>
      A user with the admin rights will use the web interface
      to take the <tt>Teacher</tt> role and see all the informations
      about the student group.
      The user interface is self explanatory, use it to see
      the possibilities.
    </p>
      
    <h2><a name="student_management">Student Management</a></h2>

    <p>
      The ACLS (access rights and much more)
      define the things the user is allowed to do
      when it is using Quenlig.
      The ACLS of an user is defined by the ACLS of the current
      role of the user and then by the ACLS specifics to the user.
    </p>
    <p>
      The roles are defined exactly the same way than users,
      there is no difference, a user name can be used as a role name.
      You can add as many roles as you want.
      Two roles are hardcoded into Quenlig:
    </p>
    <ul>
      <li> <tt>Wired</tt> role is defined recursively because
	it is the base type for all the roles.
	This role is used to define ACLS that must not be removed.
      <li> <tt>Default</tt> is defined from <tt>Wired</tt> role.
	It is the default user role and so define what the students can do.
      <li> <tt>Teacher</tt> is defined from <tt>Default</tt> role.
	It adds (and remove) ACLS in order to be used
	by the session managers and questionnary authors.
    </ul>
      You can edit ACLS and role directly in files.
      For each student and role there is a directory named
      <tt>Students/YourSessionName/Logs/TheStudent</tt>
      containing:
    </p>
    <ul>
      <li> <tt>log</tt> : all the logged data about the student.
      <li> <tt>roles</tt> : a Python list of possible roles for the user.
      <li> <tt>acls</tt> : a Python dictionnary whose keys are Quenlig plugin
	names and the values define in which ways the plugin can be used.
    </ul>
    <p>
      The modifications of <tt>Default</tt> or <tt>Teacher</tt> ACLS
      will propagate to all the users using these roles.
      If the files are modified manually Quenlig server must be
      restarted to make the change effectives.
    </p>
    
    <h2><a name="access_rights">Access Rights (ACLS)</a></h2>

    <p>
      A Quenlig page is created by the composition of many plugins.
      The ACLS defines for each plugins the operations allowed on the plugin.
      Currently the only operation is <tt>executable</tt>, in the future
      other operations may be added as <tt>movable</tt> or <tt>hidable</tt>.
    </p>
    <p>
      To change ACLS: display the students list, click on a student
      or a role and click on 'Edit ACLS'.
      Then you can for each plugin indicate if it is allowed, rejected
      or inherited from the current role.
      ACLS modification have immediate effect and are stored in files.
    </p>
    <p>
      There is an example of <tt>YourSession/Logs/Default/acls</tt> file:
      <pre>
# The file contains a Python dictionnary.
{
  # Allow the students to modify their good answer if they want.
  'question_change_answer': ('executable',),
  # Allow the students to connect at any time
  # This ACL change is commonly done for one student,
  # needing to work out of the normal hours.
  'session_start': ('!executable',),
  'session_stop': ('!executable',),
  # do not display session duration it is not applicable.
  'session_duration': ('!executable',),
  # The smileys and rank are only useful when all the student
  # are working at the same time.
  'statmenu_smiley': ('!executable',),  
  'statmenu_rank': ('!executable',),
  # Do not display the number of bad answers.
  'statmenu_bad':('!executable',),
  # Do not shuffle the questions.
  'questions_shuffle': ('!executable',),
}
</pre>
      <p>
	You can find the plugin names
	in the <a href="plugins.html">plugin reference page</a>.
	Another way is to take the <tt>Teacher</tt> role
	and click on <tt>Debug</tt>.
	A star will be visible next to each GUI element,
	by putting the cursor on the star you will find out
	the name of the plugin displaying the GUI element.
	</p>

      
      <h2><a name="author_work">Author work</a></h2>

      <p>
	The questionnary creation takes a long time,
	about one hour per question if you want to help the students.
	It is recommended to put a minimal amount of time for
	the question creation but to take more time after each session
	to analyse the bad student answers.
      </p>
      <p>
	With the teacher role, for each question 
	all the bad answers and comments will be displayed.
	The identical bad answers are merged and there is
	the list of student having given this bad answer.
      </p>
      <p>
	The bad answers that where not commented to help the student
	are with a red background.
	If there is more than one student giving this bad answer,
	an explanation must be given to the student.
      </p>
      <p>
	When adding tests to a question, the recommended way
	is to put all the Good tests in front and the
	other tests after.
	It is a bad idea to add a Reject in front of the others because
	one of the Good tests after may use the rejected string.
	If there is many Good tests, it is easy to miss the problem.
      </p>
      <p>
	The questionnary author can modify the Python source
	defining the question and then clicks on « Reload question »
	to update its page with the new question.
	It will verify the behaviour of the updated question.
	It will see the comments given to the students have
	been correctly updated.
      </p>
      <p>
	Currently, if the question change introduced a Python
	syntax error then all the questions defined in the file
	are no more accessible by the students.
	So, think twice before using this feature when
	tens of students are working.
      </p>
    
      <h2><a name="test_creation">Test creation</a></h2>
      <p>
	A test is a class with the following methods and attributes.
	The class hierarchy of test is defined in the
	<a href="tests.html">test reference documentation</a>.
	Only leaves and canonizers are explained here, see the source
	codes for the other kinds.
      </p>

      <h3><a name="leaves">Leaves of the test expression</a></h3>

      <p>
	Most of the leaves are based on string tests,
	the <tt>TestString</tt> base class is here to help,
	it provides the canonization (disablable) of the test parameter
	in <tt>self.string_canonized</tt>.
	The only thing to do to create a new test is to
	define the <tt>do_test</tt> method that is returning a boolean and
	a specific comment for the student.
      </p>
      <pre>
class Contain(TestString):
    def <em>do_test</em>(self, student_answer, state):
        return self.string_canonized in student_answer, ''
</pre>
      <p>
	The <tt>__init__</tt> and <tt>canonize_test</tt>
	methods are inherited from <tt>TestString</tt>:
      </p>
      <pre>
class TestString(TestExpression):
    def <em>__init__</em>(self, string, canonize=True):
        if not isinstance(string, basestring):
            raise ValueError("Expect a string")
        self.string = string
        self.do_canonize = canonize
    def <em>canonize_test</em>(self, parser, state):
        if self.do_canonize:
            self.string_canonized = parser(self.string, state)
        else:
            self.string_canonized = self.string
</pre>
      <p>
	The <tt>canonize_test</tt> is called when it is necessary
	to apply a canonization upon the test parameter,
	the <tt>parser</tt> function is the composition of
	all the upper canonizers.
	The canonization may depend on the session <tt>state</tt>,
	in this case, the <tt>canonize_test</tt> is called
	each time the student answers (see the <tt>HostReplace</tt> canonizer).
      </p>
	
      <h3><a name="canonizers">Canonizers</a></h3>
      <p>
	The canonizers apply a transformation on the student
	answer and/or on the children test parameters.
      </p>
      <pre>
class UpperCase(TestUnary):
    def <em>canonize</em>(self, string, state):
        return string.upper()
</pre>
      <p>
	The canonizers are automaticaly applied to student answers.
	They are applied on most tests parameters (<tt>Replace</tt>
	is an exception).
	In rare case a canonizer must apply <tt>canonize_test</tt>
	on the child expression (see the <tt>HostReplace</tt> canonizer).
	It is necessary if the canonization depends on the state value,
	for example the computer used by the student.
	To do so, the canonizer calls the <tt>initialize</tt> method
	with the current canonizer and the current state.
	<tt>self.parser</tt> contains the current upper parser
	at this point of the evaluation.
	All the children of the canonizer are in the table <tt>children</tt>,
	but every predefined canonizer only have one child.
	

      </p><pre>
    def canonize(self, string, state):
        self.children[0].<em>initialize</em>(
                lambda a_string, a_state:
                    your_canonizer(
                           <em>self.parser</em>(a_string, a_state),
                                  )
                    ),
                state)
        return your_canonizer(string)
</pre>
      <p>
	Never forget that canonization must be done from top to
	bottom (root to leaves).
	It is not the same direction than for a normal expression
	evaluation.
      </p>
      <p>
	If the canonizer works on a strict language it may detect syntax errors.
	In this case, the canonizer can shortcut the evaluation
	process and can return a comment.
      </p>
      <pre>
    def canonize(self, string, state):
        try:
            return my_canonizer(string, state)
        except MyError:
            return False, "There is a syntax error..."
</pre>          


      <h2><a name="plugin_creation">Plugin creation</a></h2>

      <p>
	Each GUI element and Quenlig functionnality is defined
	by a plugin.
	You can find the plugin names
	in the <a href="plugins.html">plugin reference page</a>,
	but an interactive way is to take the teacher role and
	to click on 'Debug'.
	A '*' will be displayed next to each plugin, you can
	put the cursor over the star to see more information.
      </p>
      <p>
	There is currently 69 plugins, their average size is about 40 lines.
	The mediane size is only 25 lines without the messages.
	It is really easy to create plugins,
	the most simple way is to start from a copy of simple existing
	plugin and modify it.
      </p>
      <p>
	Currently <a href="plugins.html#plugin_attributes">14 attributes</a>
	may define the plugin behavior and appearence.
	There is <a href="plugins.html#plugin_css_attributes">11 CSS
	  attributes</a> defining the graphical aspects and
	<b>the translations</b>.
	The plugin attributes are defined for each language.
      </p>
      <pre>Plugins/
   plugin_name/
      __init__.py      # To please Python
      plugin_name.py   # Language independent attributes
      en.py            # English specialisation
      fr.py            # French specialisation
      ...
</pre>
      <p>
	The reference contains all the attributes and plugins with their
	documentation.
	Most of the plugins are really short piece of code easely
	understandable.
	There is some things needing some explanation.
      </p>

      <h3><a name="trigger">What is triggering ?</a></h3>

      <p>
	When the web page is generated, all the allowed plugins
	are executed in order to create the page.
	But in some case, the page creation is triggered by the
	user action on a plugin.
	For example when the user answers the question, asks a tip,
	leaves a comment...
	In these cases, the triggered plugin will do its work
	to perform the required action and also generate its
	part of work to generate the web page.
      </p>
	
      <h3><a name="display">What is displayed ?</a></h3>
      <p>
	If the plugin contains other plugins then it is a
	container box with all the contained plugin stacked
	verticaly is the <a href="plugins.html#attr_horizontal">horizontal</a>
	attribute is not True.
	The box <a href="plugins.html#attr_title">title</a>
	is defined in the CSS or by the	plugin evaluation if the
	<a href="plugins.html#attr_content_is_title">content_is_title</a>
	attribute is True.
      </p>
      <p>
	If the plugin does not contain other plugin then the
	evaluation of the plugin returns the HTML code to display.
	If the <a href="plugins.html#attr_link_to_self">link_to_self</a>
	attribute is True then
	the plugin HTML is a link that <b>trigger</b> the plugin
	execution when followed.
      </p>
      <p>
	In both case, the content or the box title may be tipped
	with the localized attribute
	<a href="plugins.html#attr_tip">tip</a>.
	As all the texts in the interface, the tip in stored in the CSS
	and not in the HTML.
      </p>
      <p>
	All the generated content is boxed in an HTML element
	whose class is the plugin name.
	When defining
	<a href="plugins.html#attr_css_attributes">css_attributes</a>,
	you start the selector relatively
	to the plugin element selector.
	If your selector is empty, the style applies to the plugin element.
	If you want to define the complete selector, start it with <tt>/</tt>
      </p>
      <p>
	The order of the plugins in a container is defined by
	the <a href="plugins.html#attr_priority_display">priority_display</a>
	attribute.
	The display position can be defined as an absolute number
	or relative to another plugin.
      </p>
      <p>
	Finally, when a plugin is triggered it may generate some
	content for the core of the web page.
	It store this content in its <tt>heart_content</tt> attribute,
	the <a href="plugins.html#heart_content">heart_content</a>
	plugin retrieve this attribute to put it in good place
	at the core of the page.
      </p>
      
      <h3><a name="evaluation">Evaluation</a></h3>
      <p>
	The <a href="plugins.html#attr_execute">execute</a>
	attribute is called to generate the web page
	if the user is allowed (or imposed) to use the plugin.
	The function most important parameter indicates if the
	plugin has been triggered by the user.
      </p>
      <ul>
	<li>
	  The <a href="plugins.html#question_answer">question_answer</a>
	  plugin displays the entry where the user
	  type its answer.
	  If the user enter an answer, the plugin will check it,
	  in the other case it will display the entry with the
	  last bad answer given.
	<li>
	  The <a href="plugins.html#questions_comments">questions_comments<a/>
	  plugin display only a link to activate
	  itself if it is not triggered.
	  If triggered, it sets its own page heart content and
	  set the current question to None to remove any
	  other heart content.
      </ul>
      <p>
	The order of execution may be different than the display order.
	For example, when the user answer correctly a question
	with the <a href="plugins.html#question_answer">question_answer</a>
	plugin, all the other plugin must take this into account when
	displaying the user interface.
	So the <a href="plugins.html#question_answer">question_answer</a>
	must be executed <b>before</b> the other,
	and its generated content must be stored until needed.
	The order of execution is defined with the attribute
	<a href="plugins.html#attr_priority_execute">priority_execute</a>
	the same way than the display order.
      </p>
      <p>
	As the generated content is stored for each plugin,
	it is easy to create plugins that transform the
	generated content of other plugins.
	The <a href="plugins.html#page">page</a> and
	<a href="plugins.html#debug">debug</a> plugins are such plugins.
	But there is a catch, as the plugin modifying the other must
	be evaluated last, 2 plugins can not mutualy modify themselves.
      </p>
       
      <h2><a name="developper_tools">Developper tools</a></h2>

      <p>
	The developper tools are launchable using a Makefile goal.
	The parameters are defined in the Makefile.
      </p>
      <ul>
	<li> <tt>plot</tt>: launches Quenlig on every <b>session</b>
	  to compute the necessary graphics for the session.
	  The default graphic is the question graph, but the Cisco
	  questionnary computes a network graphic.

	<li> <tt>regtest</tt>: run the regression tests.
	  
	<li> <tt>check-questions</tt>: run sanity test on every questionnary.
	  
	<li> <tt>load_simulator</tt>: run a load simulator to see if
	  how many users the server can manage.
	  The load simulator replays real session data at real time
	  or more quickly.

	<li> <tt>profiling</tt>: same tool than the load simulator
	  but it profiles the Python functions.
	  
	<li> <tt>simulator_plot</tt>: plot the load simulator data.
	  Currently broken, do not try to use it.

	<li> <tt>xxx.histogram</tt>: use the load simulator to compute
	  an animation of the number of good answer histogram from
	  a recorded session.
	  
	<li> <tt>histogram_animation</tt>: display the previous
	  animation on screen.

	<li> <tt>clean</tt>: remove recursively garbage file.
	  
	<li> <tt>figures</tt>: run the make command without goal on the
	  HTML directory of every questionnary.

	<li> <tt>tags</tt>: compute the index of functions.

	<li> <tt>tar</tt>: compute the tar file.

      </ul>
	  
